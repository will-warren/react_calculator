<html>
<head>
<script src="https://unpkg.com/react@16/umd/react.development.js"> </script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
 integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<link rel="stylesheet" href="calculator.css">
<body>
    <div id="root"></div>
    <script type="text/babel">
    
    class Calculator extends React.Component {
        constructor() {
            super();
            this.state = {
                display: 0,
                total: 0,
                method: '',
                nums: [],
                addNew: true
            };
            this.input = this.input.bind(this);
            this.setOperator = this.setOperator.bind(this);
            this.clear = this.clear.bind(this);
            this.ce = this.ce.bind(this);
            this.togglePosNeg = this.togglePosNeg.bind(this);
            this.percent = this.percent.bind(this);
            this.equals = this.equals.bind(this);
        }

        input(value) {
            if(!Number(value)) {
                this.setOperator(value);
            } else {
                if(this.state.addNew) {
                    this.setState({
                        display: value,
                        addNew: false,
                    });
                } else {
                    this.setState({
                        display: this.state.display * 10 + value,
                    }); 
                }
                console.log(value, this.state.nums, this.state.nums["length"]);
            }
        }
        
        setOperator(op) {
            this.setState(prevState => ({
                nums: [...prevState.nums, this.state.display]
            })).then(() => {
                console.log(op, this.state.nums, this.state.display)
                if(op === '=') {
                    this.equals();
                } else {
                    this.setState({
                        method: op,
                        addNew: true
                    })
                }
            })
        }

        clear() {
            this.setState({
                display: 0,
                total: 0,
                nums: []
            })
        }

        ce() {
            this.setState({
                nums: this.state.nums["pop"],
                display: this.state.nums[this.state.nums["length"-1]]
            })
        }

        togglePosNeg() {
            this.setState(prevState => ({
                display: this.state.display * -1,
            }))
        }

        percent() {
            this.setState({
                display: this.state.display * 0.01
            })
        }

        equals() {
            switch (this.state.method) {
                case 'add':;
                    const sum = this.state.nums.reduce((acc, num) => acc + num)
                    console.log(sum, this.state.nums)
                    this.setState({
                        display: sum,
                        total: sum
                    });
                    break;
                case 'subtract':
                    this.setState({
                        total: this.state.total - this.state.display,
                        display: total
                    })
                    break;
                case 'multiply':
                    this.setState({
                        total: this.state.total + this.state.display,
                        display: total
                    })
                    break;
                case 'divide':
                    this.setState({
                        total: this.state.total + this.state.display,
                        display: total
                    })
                    break;
            }
        }

        render() {
            return (
                <div class="container text-center">
                    <h1>WWIV</h1>
                    <div class="squeeze">
                        <div class="jumbotron" id="calc-display">{this.state.display}</div>
                        <div class="row calc-pad">
                            <div class="col-md-3"><button class="btn btn-danger" onClick={this.clear}>CLEAR</button></div>
                            <div class="col-md-2"><button class="btn btn-light" onClick={this.togglePosNeg}>+/-</button></div>
                            <div class="col-md-2"><button class="btn btn-light" onClick={this.percent}>%</button></div>
                            <div class="col-md-2"><button class="btn btn-light" onClick={this.powerOf} disabled>^</button></div>
                            <div class="col-md-3"><button class="btn btn-warning" onClick={this.ce}>CE</button></div>
                        </div>
                        <div class="row calc-pad">
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 7)}>7</button></div>
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 8)}>8</button></div>
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 9)}>9</button></div>
                            <div class="col-md-3"><button class="btn btn-dark" onClick={this.input.bind(this, 'multiply')}>x</button></div>
                            
                        </div>
                        <div class="row calc-pad">
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 4)}>4</button></div>
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 5)}>5</button></div>
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 6)}>6</button></div>
                            <div class="col-md-3"><button class="btn btn-dark" onClick={this.input.bind(this, 'subtract')}>-</button></div>
                        </div>
                        <div class="row calc-pad">
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 1)}>1</button></div>
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 2)}>2</button></div>
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 3)}>3</button></div>
                            <div class="col-md-3"><button class="btn btn-dark" onClick={this.input.bind(this, 'add')}>+</button></div>
                        </div>
                        <div class="row calc-pad">
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, 0)}>0</button></div>
                            <div class="col-md-3"><button class="btn btn-light" onClick={this.input.bind(this, '.')}>.</button></div>
                            <div class="col-md-3"><button class="btn btn-info" onClick={this.input.bind(this, '=')}>=</button></div>
                            <div class="col-md-3"><button class="btn btn-dark" onClick={this.input.bind(this, 'divide')}>/</button></div>
                        </div>
                    </div>
                    
                </div>
            )
        }
    }

    ReactDOM.render(
        <Calculator />,
        document.getElementById("root")
    );
   
    </script>
</body>
</html>